---
import {getCollection} from 'astro:content';
import {Image} from 'astro:assets';
import PageLayout from '../layouts/PageLayout.astro';
import PageMeta from '../components/PageMeta.astro';
import {SITE_TITLE} from '../config';

const allPosts = await getCollection('artist');

const sortedPosts = allPosts
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.filter((post) => !post.data.draft);
---

<PageLayout>
	<PageMeta title={SITE_TITLE} slot="meta" />
	<section slot="main">
		<div class="mx-auto max-w-3xl space-y-8 px-6 sm:px-8">
			{
				sortedPosts.map((post) => {
					const formattedDate = new Date(
						post.data.publishDate
					).toLocaleDateString('en-us', {
						year: 'numeric',
						month: 'short',
						day: 'numeric',
					});
					return (
						<div>
							<div class="relative flex overflow-hidden rounded-md border-2 border-primary-main p-2 sm:p-6">
								<div class="relative h-44 w-16 flex-none border-r-2 border-primary-main sm:h-40 sm:w-24">
									<div class="absolute inset-0 h-full w-full bg-gradient-to-r from-transparent to-bg-body" />
									<div class="h-full w-full bg-cover bg-center">
										<Image
											class="h-full w-full object-cover"
											src={post.data.avatar}
											alt={`${post.data.name} avatar`}
										/>
									</div>
								</div>
								<div class="ml-2 flex h-44 max-w-full flex-col justify-between overflow-hidden sm:ml-4 sm:h-40">
									<div>
										<h2 class="text-xl font-extrabold text-primary-main sm:text-3xl">
											<a
												href={`/artist/${post.slug}`}
												class="unset animated-link"
											>
												{post.data.name}
											</a>
										</h2>
										<div class="block sm:hidden">
											<span class="text-sm text-text-muted">monthly:</span>
											{post.data.monthlyListeners.toLocaleString('en-US')}
										</div>
									</div>
									<div class="prose prose-sleek  text-sm sm:text-base">
										<p class="flex line-clamp-3 sm:line-clamp-2">
											{post.data.description}
										</p>
									</div>
									<span class="flex max-w-full overflow-x-auto">
										{post.data.tags?.map((tag) => {
											return (
												<span class="mr-2 flex-none rounded bg-primary-main px-1 py-0.5 text-xs text-bg-body last:mr-0 sm:text-sm">
													{tag}
												</span>
											);
										})}
									</span>
								</div>
								<div class="absolute top-0 right-0 hidden rounded-bl-md bg-primary-main px-2 text-xl font-bold text-bg-body sm:block sm:text-2xl">
									{post.data.monthlyListeners.toLocaleString('en-US')}
								</div>
							</div>
							<div class="mt-1 flex justify-end text-xs italic text-text-muted sm:text-sm">
								<time datetime={post.data.publishDate.toISOString()}>
									{formattedDate}
								</time>
							</div>
						</div>
					);
				})
			}
		</div>
	</section>
</PageLayout>
